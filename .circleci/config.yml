version: 2
jobs:
  build:
    working_directory: ~/code
    docker:
    - image: circleci/android:api-27-alpha
    environment:
    - CIRCLE_COMPARE_URL: https://github.com/vietthanhle89/EspressoCircleCI/compare/5184e7b5c067...4a4405189a2b
    - JVM_OPTS: -Xmx3200m
    steps:
    - checkout
    - run:
        name: Copy SDK License
        command: (echo y; echo y; echo y; echo y; echo y; echo y) | $ANDROID_HOME/tools/bin/sdkmanager --licenses
    - run:
        name: Create emulator
        command: |
          set -e
          sdkmanager --update
          sdkmanager "system-images;android-22;default;armeabi-v7a"
          echo "no" | avdmanager create avd -n ThanhLeDevice -k "system-images;android-22;default;armeabi-v7a"
          avdmanager list
    - run:
        name: Launch emulator
        command: emulator -avd ThanhLeDevice -noaudio -no-boot-anim -no-window -accel on
        background: true
    - run:
        name: Wait emulator
        command: circle-android wait-for-boot
    - store_artifacts:
        path: app/build/reports
        destination: reports
    - store_test_results:
        path: app/build/test-results
